<?python
searchtext = _('search this site...')
?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip="">
  
  <div py:def="site_search(site)" id="sitesearch" style="float: right;">
    <form method="get" action="${site.site_url('search')}" 
	  onsubmit="if(q.value.replace(/^\s*/, '').replace(/\s*$/, '') =='') return false;">
      <input id="q" name="q" maxlength="100" size="25" type="text" 
	     value="${searchtext}" onblur="if(this.value=='') this.value='${searchtext}';" 
	     onfocus="if(this.value=='${searchtext}') this.value='';"/>
    </form>
  </div>
  
  <div py:def="site_banner(site)" py:strip="True">
    <div id="sitebanner">
      ${site_search(site)}
      <div class="deptident">
	${site.owner.last_name} 
      &bull; ${site.term.name} 
      &bull; ${site.course.department}</div>
      <h1><a href="${site.site_url()}"><span py:if="site.course">${site.course.code}: </span>${site.course.name}</a></h1>
    </div>
  </div>
  
  <!-- !show_tree: display a tree of items in a hierarchical style. -->
  <ul py:def="show_tree(tree, edit=False)"
      py:if="tree"
      class="itemtree">
    <li py:for="item, subs in tree" class="item_${item.item_type} an_item"
	id="item_${item.id}">
      <abbr py:if="item.marcxml" class="unapi-id" title="${item.id}"/>
      <div class="availability" py:if="item.item_type == 'PHYS'">
	<?python
	  stat = callhook('item_status', item) if (item.item_type == 'PHYS') else None
	  valid = stat is not None
	?>
	<div py:if="valid" py:with="(_lib, _desk, _avail) = stat"
	     class="${_avail &gt; 0 and 'available' or 'unavailable'}"
	     title="${_avail} of ${_desk} copies available at reserves desk; ${_lib} total copies in library system">
	  ${_avail}/${_desk}
	</div>
	<div py:if="not valid" title="No copies are available at the reserves desk. No further status information is available.">
	  &#x2205;
	</div>
      </div>
      <div class="availability avail_nonphys" py:if="item.item_type != 'PHYS'">
      </div>
      <div class="mainline ${item.item_type=='HEADING' and 'headingmainline' or ''}">
		<a href="${item.item_url()}" class="mainlink">${item}</a> 
      </div>
      <div class="author_pub" py:if="item.author or item.publisher">
		${item.author}. ${item.publisher}.
      </div>
	  <div>
		<div class="menublock" py:if="not (item.item_type=='HEADING' and not edit)">
		  <span py:if="item.needs_meta_link()">
			<a href="${item.item_url('meta')}">About this item</a>
			<span py:if="edit">&bull;</span>
		  </span>
		  <span py:if="edit">
			<a href="${item.item_url('edit/')}">Edit</a>
			&bull; <a href="${item.item_url('relocate/')}">Relocate</a>
			&bull; <a href="${item.item_url('delete/')}">Delete</a>
		  </span>
		</div>
	  </div>
      <!-- !to show a full tree, uncomment the following: -->
      ${show_tree(subs, edit)}
    </li>
  </ul>

  <ul py:def="heading_tree(tree, stop_at=None)" class="heading_tree">
    <li><input type="radio" name="heading" value="0" id="heading_0"/><label for="heading_0">Top Level</label></li>
    ${_heading_tree(tree, stop_at)}
  </ul>

  <ul py:def="_heading_tree(tree, stop_at=None)">
    <li py:for="item, subs in tree" py:if="item.item_type=='HEADING' and item != stop_at">
      <input type="radio" name="heading" value="${item.id}" id="heading_${item.id}"/><label for="heading_${item.id}">${item}</label>
      ${_heading_tree(subs, stop_at)}
      </li>
  </ul>
  
  <div py:def="nested_title(item)"
       py:if="item"
       py:with="hier=item.hierarchy()[:-1]; lastnum=len(hier)"
       class="nestedtitle">
    <div id="breadcrumbs">
      <span><a href="${item.site.site_url()}">Top</a></span>
      <span py:for="n, x in enumerate(hier)">
	 &raquo; <a href="${x.item_url()}">${x.title}</a>
      </span>
      <span py:if="item.item_type=='HEADING'">
	&raquo; <span class="final_item">${item.title}</span>
      </span>
    </div>
  </div>
  
  <div py:def="add_subs(parent=None)" class="itemadd">
    <div>Add a new item:</div>
    <ul py:with="prefix = (not parent) and 'item/0/' or ''">
      <li><a href="${prefix}add/?item_type=HEADING">Subheading</a></li>
      <li><a href="${prefix}add/?item_type=URL">URL</a></li>
      <li><a href="${prefix}add/?item_type=ELEC">Electronic Document</a></li>
      <li><a href="${prefix}add/?item_type=PHYS">Physical Item or Catalogued Electronic Item</a></li>
    </ul>
  </div>

  <div py:def="item_metadata_formset_header()" py:strip="True">
    <script type="text/javascript">
      $(function() {$('#metadatatable').hide(); });
      function show_metadata() {
      $('#metadatatable').show();
      $('#show_metadata').fadeOut();
      }
    </script>
  </div>

  <div py:def="item_metadata_formset(show_more=True)">
      <p py:if="show_more"><a href="javascript:show_metadata();" id="show_metadata">Show more attributes</a></p>
      <div  id="metadatatable">
      ${Markup(metadata_formset.management_form)}
      <table class="metadata_table">
	<thead>
	  <tr><th>Attribute</th><th>Value</th><th/><th>Delete?</th></tr>
	</thead>
	<tbody>
	<tr py:for="form in metadata_formset.forms">
	  <td py:if="cell" class="meta${n}" py:for="n, cell in enumerate(form)">${Markup(cell)}</td>
	</tr>
	</tbody>
      </table>
      </div>
   </div>
   
    <div py:def="offer_to_delete(item)" class="little_action_panel" py:if="item.id">
      <a href="../delete/">Delete this item</a>
    </div>

</html>

