<?python
searchtext = _('search this course...')
?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip="">
  
  <div py:def="course_search(course)"
       id="coursesearch" style="float: right;">
    <form method="get" action="${course.course_url('search')}" 
	  onsubmit="if(q.value.replace(/^\s*/, '').replace(/\s*$/, '') =='') return false;">
      <input id="q" name="q" maxlength="100" size="25" type="text" 
	     value="${searchtext}" onblur="if(this.value=='') this.value='${searchtext}';" 
	     onfocus="if(this.value=='${searchtext}') this.value='';"/>
    </form>
  </div>
  
  <div py:def="course_banner(course)" py:strip="True">
    <div id="coursebanner">
      <div class="deptident">${course.department}</div>
      ${course_search(course)}
      <h1><a href="${course.course_url()}"><span py:if="course.code">${course.code}: </span>${course.title}</a></h1>
    </div>
      <div id="feeds_panel"><a href="${course.course_url('feeds/')}">Feeds</a></div>
  </div>
  
  <!-- !show_tree: display a tree of items in a hierarchical style. -->
  <ul py:def="show_tree(tree, edit=False)"
      py:if="tree"
      class="itemtree">
    <li py:for="item, subs in tree" class="item_${item.item_type} an_item"
	id="item_${item.id}">
      <div class="mainline">
	<a href="${item.item_url()}" class="mainlink">${item}</a> 
	<span class="menublock" py:if="not (item.item_type=='HEADING' and not edit)">
	<span py:if="item.needs_meta_link()">
	<a href="${item.item_url('meta')}">about</a> </span>
	<span py:if="edit">
	  &bull; <a href="${item.item_url('edit/')}">edit</a>
	</span>
	<span py:if="edit">
	  &bull; <a href="${item.item_url('relocate/')}">put under heading</a>
	</span>
      </span>
      </div>
      <!-- !to show a full tree, uncomment the following: -->
      ${show_tree(subs, edit)}
    </li>
  </ul>

  <ul py:def="heading_tree(tree, stop_at=None)" class="heading_tree">
    <li><input type="radio" name="heading" value="0" id="heading_0"/><label for="heading_0">Top Level</label></li>
    ${_heading_tree(tree, stop_at)}
  </ul>

  <ul py:def="_heading_tree(tree, stop_at=None)">
    <li py:for="item, subs in tree" py:if="item.item_type=='HEADING' and item != stop_at">
      <input type="radio" name="heading" value="${item.id}" id="heading_${item.id}"/><label for="heading_${item.id}">${item}</label>
      ${_heading_tree(subs, stop_at)}
      </li>
  </ul>
  
  <div py:def="nested_title(item)"
       py:if="item"
       py:with="hier=item.hierarchy()[:-1]; lastnum=len(hier)"
       class="nestedtitle">
    <div class="breadcrumbs">
      <span><a href="${item.course.course_url()}">Top</a></span> &raquo;
      <span py:for="n, x in enumerate(hier)"><a href="${x.item_url()}">${x.title}</a> &raquo; </span>
      <span class="final_item">${item.title}</span>
    </div>
  </div>
  
  <div py:def="add_subs(parent=None)" class="itemadd">
    <div>Add a new item:</div>
    <ul py:with="prefix = (not parent) and 'item/0/' or ''">
      <li><a href="${prefix}add/?item_type=HEADING">Subheading</a></li>
      <li><a href="${prefix}add/?item_type=URL">URL</a></li>
      <li><a href="${prefix}add/?item_type=ELEC">Electronic Document</a></li>
      <li><a href="${prefix}add/?item_type=PHYS">Physical Book/Document</a></li>
    </ul>
  </div>

  <div py:def="item_metadata_formset_header()" py:strip="True">
    <script type="text/javascript">
      $(function() {$('#metadatatable').hide(); });
      function show_metadata() {
      $('#metadatatable').show();
      $('#show_metadata').fadeOut();
      }
    </script>
  </div>

  <div py:def="item_metadata_formset(show_more=True)">
      <p py:if="show_more"><a href="javascript:show_metadata();" id="show_metadata">Show more attributes</a></p>
      <div  id="metadatatable">
      ${Markup(metadata_formset.management_form)}
      <table class="pagetable">
	<thead>
	  <tr><th>Attribute</th><th>Value</th><th/><th>Delete?</th></tr>
	</thead>
	<tbody>
	<tr py:for="form in metadata_formset.forms">
	  <!-- <td style="border: gray 1px solid; padding: 4; ">${Markup(form.as_p())}</td> -->
	  <td py:for="cell in form">${Markup(cell)}</td>
	</tr>
	</tbody>
      </table>
      </div>
   </div>

   <div py:def="item_resequence_panel()" py:strip="True">
    <div id="resequence_panel" class="little_action_panel">
      <a href="javascript:doResequence();">Resequence items</a>
    </div>
    <div style="display: none;">
      <span id="i18n-save-order">Save Sequence</span>
      <span id="i18n-resequence-items">Resequence Items</span>
      <span id="i18n-new-order-saved">The new sequence has been saved.</span>
      <div id="ropanelmessage" style="clear: right; width: 10em;"
	   class="little_action_panel">Drag the items around. Then click Save Sequence, above.</div>
    </div>
    </div>

</html>

