<?python
title = _('Z39.50 Test, with Evergreen giving item availability')
# I just made up these keys...
keys = [('245a', 'Title'), ('100a', 'Author'), ('260c', 'PubDate'), ('901c', 'BibID')]
?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/">
<xi:include href="master.xhtml"/>
<xi:include href="paginate.xhtml"/>
<head>
  <title>${title}</title>
  <style>
    tbody.available { background-color: #dfd; }
    .lesser { font-size: smaller; color: gray; display: none; }
  </style>
  <script type="text/javascript">
    <!-- !This ought to be in paginate.xhtml, not here. how to do? -->
    $(function() { $('.pagetable').tablesorter(); });
  </script>
</head>
<body>
    <h1>${title}</h1>
    <p><a href="javascript:$('.lesser').show(); void(0);">show more detail</a></p>
    <table py:for="res in results" style="margin: 1em 0; border: black 1px solid;">
      <?python 
	is_available = res.get('avail') and (res['avail']['available'] or res['avail']['holdable'])
      ?>
      <tbody class="${is_available and 'available' or ''}">
      <tr py:for="k, title in keys" py:if="k in res">
	<th>${title}</th><td>${res[k]}</td>
      </tr>
      <tr py:if="'avail' in res">
	<th>Availability</th>
	<td>
	  <div py:for="k,v in res['avail'].items()">
	  ${'%s = %s' % (k,v)}
	  </div>
	</td>
      </tr>
      <?python allkeys = res.keys(); allkeys.sort(); ?>
      <tr py:for="k in allkeys" class="lesser">
	<th>${k}</th><td>${res[k]}</td>
      </tr>
      </tbody>
    </table>
</body>
</html>
