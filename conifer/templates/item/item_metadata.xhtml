<?python
from django.utils.simplejson import loads
site_title = '%s: %s (%s)' % (site.course.code, site.course.name, site.term)
hier = item.hierarchy()[:-1]
title = item.title
is_editor = site.can_edit(request.user)
?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/">
  <xi:include href="../master.xhtml"/>
  <xi:include href="../components/site.xhtml"/>
  <head>
    <title>${title}</title>
    <style>
      .available   { color: green; border-left: 16px green solid; padding-left: 8px; }
      .unavailable { color: red; border-left: 16px red solid; padding-left: 8px; }
    </style>
  </head>
  <body>
    ${site_banner(site)}
    ${nested_title(item)}
    <div py:if="is_editor" id="sidepanel">
      <div>
	<a href="edit/">Edit this item</a>
      </div>
      <div>
	<a href="delete/">Delete this item</a>
      </div>
      <div>
	<a href="relocate/">Relocate this item</a>
      </div>
    </div>
    <table class="metadata_table" style="margin-top: 1em;">
      <tr><th>Title</th><td>${item.title}</td></tr>
      <tr py:if="item.author"><th>Author</th><td>${item.author}</td></tr>
      <tr py:if="item.publisher"><th>Publisher</th><td>${item.publisher}</td></tr>
      <tr py:if="item.published"><th>Published</th><td>${item.published}</td></tr>
      <tr><th>Type</th><td>${item.get_item_type_display()}</td></tr>
      <tr py:if="item.item_type=='PHYS'"
	  py:with="avail, status = item.describe_physical_item_status()">
	<th>Status</th><td><div class="${avail and 'available' or 'unavailable'}">${status}</div></td>
      </tr>
      <tr py:if="item.url"><th>URL</th><td><a href="${item.url}">${item.url}</a></td></tr>
    </table>
    <div py:if="item.item_type=='ELEC'">
      <h2 class="metadata_subhead">Attached document</h2>
      <table class="metadata_table">
	<tr><th>Content type</th><td>${item.fileobj_mimetype}</td></tr>
	<tr><th>Size</th><td>${item.fileobj.size} bytes</td></tr>
	<tr><th/><td><a class="bigdownload" href="${item.item_download_url()}">Download</a></td></tr>
      </table>
    </div>
    <div py:if="item.marcxml">
      <abbr py:if="item.marcxml" class="unapi-id" title="${item.id}"/>
      <p id="marcdatashow"><a href="javascript:void($('#marcdata').toggle());">Display MARC Record</a></p>
	    <div id="marcdata" style="display: none;">
	      <?python dct = item.marc_as_dict(); keys=dct.keys(); keys.sort() ?>
	      <table class="metadata_table">
		<tr py:for="k in keys">
		  <th>${k}</th>
		  <td>${dct[k]}</td>
		</tr>
	      </table>
	    </div>
    </div>
    <div py:if="item.bib_id and gethook('bib_id_to_url')"
	 py:with="url=callhook('bib_id_to_url', item.bib_id)">
      <a py:if="url" href="${url}">View catalogue entry</a>
    </div>
  </body>
</html>
