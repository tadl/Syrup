<?python
from django.utils.simplejson import loads
course_title = '%s: %s (%s)' % (course.code, course.title, course.term)
hier = item.hierarchy()[:-1]
title = item.title
smallint = item.smallint()
metadata = item.metadata_set.all()
is_editor = course.can_edit(request.user)
?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/">
  <xi:include href="../master.xhtml"/>
  <xi:include href="../components/course.xhtml"/>
  <head>
    <title>${title}</title>
    <style>
      .available   { color: green; border-left: 16px green solid; padding-left: 8px; }
      .unavailable { color: red; border-left: 16px red solid; padding-left: 8px; }
    </style>
  </head>
  <body>
    ${course_banner(course)}
    ${nested_title(item)}
    <div py:if="is_editor" id="sidepanel">
      <div>
	<a href="edit/">Edit this item</a>
      </div>
      <div>
	<a href="delete/">Delete this item</a>
      </div>
      <div>
	<a href="relocate/">Relocate this item</a>
      </div>
    </div>
    <table class="metadata_table" style="margin-top: 1em;">
      <tr><th>Title</th><td>${item.title}</td></tr>
      <tr><th>Type</th><td>${item.get_item_type_display()}</td></tr>
      <tr py:if="item.item_type=='PHYS'"
	  py:with="avail, status = item.describe_physical_item_status()">
	<th>Status</th><td><div class="${avail and 'available' or 'unavailable'}">${status}</div></td>
      </tr>
      <tr py:if="smallint">
	<th>Small Number</th><td>${smallint}</td>
      </tr>
      <tr py:if="item.url"><th>URL</th><td><a href="${item.url}">${item.url}</a></td></tr>
    </table>
    <div py:if="item.item_type=='ELEC'">
      <h2 class="metadata_subhead">Attached document</h2>
      <table class="metadata_table">
	<tr><th>Content type</th><td>${item.fileobj_mimetype}</td></tr>
	<tr><th>Size</th><td>${item.fileobj.size} bytes</td></tr>
	<tr><th/><td><a class="bigdownload" href="${item.item_url()}">Download</a></td></tr>
      </table>
    </div>
    <div py:if="metadata">
      <h2 class="metadata_subhead">Additional metadata</h2>
      <table class="metadata_table">
	<tr py:for="attr in metadata">
	  <th>${attr.get_name_display()}</th>
	  <td py:if="attr.name != 'syrup:marc'">
	    ${attr.value}
	  </td>
	  <td py:if="attr.name == 'syrup:marc'">
	    <div id="marcdatashow"><a href="javascript:$('#marcdata').show();$('#marcdatashow').hide();void(0);">show</a></div>
	    <div id="marcdata" style="display: none;">
	      <?python dct = loads(attr.value); keys=dct.keys(); keys.sort() ?>
	      <table>
		<tr py:for="k in keys">
		  <th>${k}</th>
		  <td>${dct[k]}</td>
		</tr>
	      </table>
	    </div>
	  </td>
	</tr>
      </table>
      </div>
  </body>
</html>
