<?python
title = _('All Reserves, by Department')

sites = models.Site.objects.order_by('course__department__name', 'course__code', 'owner__last_name').select_related()
blocks = itertools.groupby(sites, lambda s: s.course.department)
?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/">
<xi:include href="master.xhtml"/>
<head>
  <title>${title}</title>
</head>
<body>
  <h1>${title}</h1>
  <div py:if="user.is_anonymous()">
    (Note: some reserve materials may require you
    to <a href="${ROOT}${settings.LOGIN_URL}?next=${ROOT}/">log in</a>)
  </div>
  
  <img py:def="lock(condition=True)" 
	   py:if="condition"
	   src="${ROOT}/static/tango/lock.png"
	   alt="lock" title="This resource is access-controlled."/>
  
  <div py:for="(dept, ss) in blocks">
	<h2>${dept}</h2>
	<div py:for="site in ss">
	  <span py:if="not site.is_open_to(request.user)" style="float: left;">
		${lock()}
	  </span>
	  <p style="margin-left: 26px;">
		
		<a href="${site.site_url()}">${site}</a>
      </p>
	</div>
  </div>
  <div class="gap"/>
</body>
</html>
