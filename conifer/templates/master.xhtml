<?python
app_name = _('Syrup E-Reserve System')
search = _('search...')
?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip="">
  <py:match path="head" once="True">
    <head py:attrs="select('@*')"
	  py:with="t=list(select('title/text()'))">
      <title>${app_name}<py:if test="t">: ${t}</py:if></title>
    <link rel="stylesheet" type="text/css" href="/static/main.css"/>
    <script type="text/javascript" src="/static/jquery/js/jquery-1.3.2.min.js"/>
    <script type="text/javascript" src="/static/jquery/js/jquery-ui-1.7.1.custom.min.js"/>
    <script type="text/javascript" src="/static/jquery/js/jquery.tablesorter.min.js"/>
    ${select('*[local-name()!="title"]')}
    </head>
  </py:match>
  <py:match path="body" once="true">
    <body py:attrs="select('@*')">
      <div id="outer">
      <div id="brandheader">
	<div style="float: right; font-size: x-large; padding: 12; color: #888;">
	  ${app_name}
	</div>
	<img src="/static/institution-logo.png" style="height: 50;"/>
      </div>
        <!--
      <div id="header" py:if="user.is_authenticated()">
        trying to keep the search box consistent for now
        -->
      <div id="header">
        <div id="search">
            <form method="get" action="/syrup/search" 
                onsubmit="if(q.value.replace(/^\s*/, '').replace(/\s*$/, '') =='') return false;"
            >
            <input id="q" name="q" maxlength="100" size="25" type="text" 
                value="${search}" onblur="if(this.value=='') this.value='${search}';" 
                onfocus="if(this.value=='${search}') this.value='';"/>
            </form>
        </div>
      <span py:if="user.is_authenticated()">
	<strong style="padding-right: 18;">Welcome, ${user.first_name or user.username}!</strong>
	<a href="/accounts/logout">Log Out</a>
	&bull; <a href="/syrup/prefs/">Preferences</a>
      </span>
      <span py:if="not user.is_authenticated()">
	<strong style="padding-right: 18;">Welcome!</strong>
	<a class="loginbutton" href="/accounts/login/">Log In</a>
	&bull; <a href="/syrup/prefs/">Preferences</a>
      </span>
    </div>
      <xi:include py:if="user.is_authenticated()" href="tabbar.xhtml"/>
      <xi:include py:if="not user.is_authenticated()" href="tabbar_anonymous.xhtml"/>
      <div id="mainpanel">
	${select('*|text()')}
      </div>
      <div id="footer">
	<div> 
    <!--
        !We may eventually have a tab bar for non authenticated users,
        but we definitely need a start over option for now. There is
        probably a more elegant way of detecting whether we are on
        the front page but this works for the short term
    -->
    <span py:if="not user.is_authenticated() and not request.META.PATH_INFO == '/syrup/'">
        <a href="/syrup">Start Over</a>  -
    </span>
    Syrup is a subproject of <a href="http://conifer.mcmaster.ca/">Project Conifer</a> &copy; 2009
    </div>
      </div>
      </div>
    </body>
  </py:match>
</html>
